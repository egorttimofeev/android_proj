# Приложение для бронирования номеров отеля

Android-приложение для поиска и просмотра доступных номеров отеля с фильтрацией по датам и количеству гостей.

## Описание проекта

Приложение предоставляет следующие возможности:
- **Авторизация**: вход и регистрация пользователей
- **Просмотр номеров**: список всех номеров с фильтрацией по статусу (все/доступные/недоступные)
- **Поиск номеров**: фильтрация по датам заезда/выезда и количеству гостей
- **Детальная информация**: подробное описание каждого номера с фотографией

## Технологический стек

- **Язык**: Kotlin
- **Минимальная версия Android**: SDK 24 (Android 7.0)
- **Целевая версия**: SDK 36
- **UI**: Jetpack Compose 1.7.6 + Material 3 1.3.1
- **База данных**: Room 2.6.1 (SQLite)
- **Навигация**: Navigation Compose 2.8.5
- **Асинхронность**: Kotlin Coroutines + Flow
- **Загрузка изображений**: Coil 2.7.0
- **Хранилище настроек**: DataStore 1.1.1
- **Сеть**: Retrofit 2.11.0 (для будущего расширения)

## Архитектура

Приложение следует архитектуре **MVVM (Model-View-ViewModel)** с использованием паттерна **Repository**:

```
app/
├── data/
│   ├── local/              # Локальная база данных
│   │   ├── dao/           # Data Access Objects
│   │   ├── entity/        # Сущности БД
│   │   ├── AppDatabase.kt
│   │   ├── DatabaseSeeder.kt
│   │   └── UserPreferences.kt
│   ├── mapper/            # Преобразование Entity <-> Model
│   ├── model/             # Модели данных для UI
│   └── repository/        # Репозитории для доступа к данным
├── ui/
│   ├── auth/              # Экраны авторизации (Login, Register)
│   ├── menu/              # Главное меню
│   ├── rooms/             # Список и детали номеров
│   ├── search/            # Поиск номеров по фильтрам
│   ├── navigation/        # Навигация между экранами
│   └── theme/             # Тема оформления
└── MainActivity.kt
```

## Структура базы данных

Приложение использует **SQLite** через библиотеку **Room**. База данных содержит 4 таблицы.

**Важно**: База данных создается автоматически на устройстве Android при первом запуске приложения и хранится по пути:
```
/data/data/com.example.myapplication/databases/app_database
```

Данные (пользователи, номера, бронирования, изображения) заполняются через класс `DatabaseSeeder` при первом запуске. 

Фотографии **не хранятся в БД** - в базе хранятся только пути к файлам в папке `assets/photos/`, а сами изображения остаются в APK файле приложения.

### 1. users (Пользователи)
| Поле     | Тип    | Описание              |
|----------|--------|-----------------------|
| id       | Int    | Первичный ключ        |
| username | String | Имя пользователя      |
| email    | String | Email (уникальный)    |
| token    | String | Токен авторизации     |
| password | String | Пароль (хеш)          |

### 2. rooms (Номера)
| Поле        | Тип    | Описание                          |
|-------------|--------|-----------------------------------|
| id          | Int    | Первичный ключ                    |
| name        | String | Название номера                   |
| description | String | Описание номера                   |
| imageUrl    | String | Путь к изображению в assets       |
| capacity    | Int    | Вместимость (количество гостей)   |
| price       | Double | Цена за ночь (в рублях)           |
| amenities   | String | Удобства (Wi-Fi, ТВ, кондиционер) |
| status      | String | Статус (AVAILABLE/UNAVAILABLE)    |
| createdAt   | String | Дата создания записи              |
| cachedAt    | Long   | Время кеширования                 |

### 3. bookings (Бронирования)
| Поле         | Тип    | Описание                      |
|--------------|--------|-------------------------------|
| id           | Int    | Первичный ключ (автоинкремент)|
| roomId       | Int    | ID забронированного номера    |
| checkInDate  | String | Дата заезда (yyyy-MM-dd)      |
| checkOutDate | String | Дата выезда (yyyy-MM-dd)      |
| guestName    | String | Имя гостя                     |
| guestCount   | Int    | Количество гостей             |

### 4. images (Изображения)
| Поле         | Тип    | Описание                   |
|--------------|--------|----------------------------|
| id           | Int    | Первичный ключ             |
| url          | String | URL изображения            |
| title        | String | Название изображения       |
| description  | String | Описание                   |
| createdAt    | String | Дата создания              |
| thumbnailUrl | String | URL миниатюры              |

## Основные компоненты

### Репозитории
- **AuthRepository**: управление авторизацией (вход, регистрация, logout)
- **RoomRepository**: получение и фильтрация номеров

### ViewModels
- **AuthViewModel**: управление состоянием авторизации
- **RoomsViewModel**: управление списком номеров и фильтрами
- **RoomDetailViewModel**: детальная информация о номере

### Экраны
1. **LoginScreen**: вход пользователя
2. **RegisterScreen**: регистрация нового пользователя
3. **MainMenuScreen**: главное меню с двумя кнопками:
   - Поиск номеров по фильтрам
   - Просмотр всех номеров
4. **SearchRoomsScreen**: форма поиска (даты + количество гостей)
5. **SearchResultsScreen**: результаты поиска
6. **RoomsListScreen**: список всех номеров с фильтрами (все/доступные/недоступные)
7. **RoomDetailScreen**: детальная информация о номере

## Логика фильтрации

При поиске номеров по датам и количеству гостей применяются следующие правила:

1. **Вместимость**: `room.capacity >= guestCount`
2. **Статус**: `room.status == AVAILABLE`
3. **Отсутствие конфликтов**: проверяется пересечение дат с существующими бронированиями через SQL-запрос:
   ```sql
   SELECT * FROM bookings 
   WHERE roomId = :roomId 
   AND (checkInDate <= :checkOut AND checkOutDate >= :checkIn)
   ```

Если запрос возвращает записи, номер считается занятым на выбранные даты.

## Тестовые данные

При первом запуске приложение автоматически заполняет БД тестовыми данными:

### Пользователи (логин/пароль):
- 1/1
- 2/2

**Важно**: При регистрации нового пользователя пароль сохраняется, и для входа нужно использовать введенный при регистрации пароль (не логин).

### Номера:
Создаются на основе фотографий из папки `app/src/main/assets/photos/`
- 7 номеров с различной вместимостью (1-4 гостя)
- Цены от 2500 до 6000 рублей за ночь
- Каждый третий номер имеет статус UNAVAILABLE

### Тестовые бронирования (2025 год):
- **Номер 1**: занят 25-27 ноября и 30 ноября - 2 декабря
- **Номер 2**: занят 26-28 ноября

## Сборка и запуск

### Требования:
- Android Studio Hedgehog или новее
- JDK 17 или новее
- Android SDK 24+

### Запуск:
1. Откройте проект в Android Studio
2. Подождите завершения синхронизации Gradle
3. Подключите устройство или запустите эмулятор
4. Нажмите Run (▶️)

### Сборка APK:
```bash
./gradlew assembleDebug
```
APK будет создан в `app/build/outputs/apk/debug/`

## Навигация

```
Login → MainMenu → SearchRooms → SearchResults → RoomDetail
                 ↓
                AllRooms → RoomDetail
```

- Из любого экрана доступна кнопка "Назад" для возврата на предыдущий экран
- Logout очищает стек навигации и возвращает на экран входа
- При повторном входе на SearchRooms старый backstack очищается

## Особенности реализации

- **Даты**: UI использует формат `dd.MM.yyyy`, БД хранит в `yyyy-MM-dd`
- **Изображения**: загружаются из `assets/photos/` через Coil с префиксом `file:///android_asset/`
- **Состояния**: используется `StateFlow` для реактивного обновления UI
- **Конфигурация**: при смене ориентации состояние экранов поиска сохраняется через `rememberSaveable`

## Лицензия

Учебный проект для демонстрации навыков разработки Android-приложений.